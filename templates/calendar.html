<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Calendar ‚Ä¢ Smart Assistant</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- FullCalendar -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

    <style>
        body {
            background: linear-gradient(135deg, #B3CFE5, #F6FAFD);
            font-family: "Poppins", sans-serif;
            padding: 20px;
            min-height: 100vh;
        }

        .card-box {
            background: #ffffff;
            border-radius: 22px;
            border: 2px solid #B3CFE5;
            box-shadow: 0 8px 25px rgba(26, 61, 99, 0.18);
            padding: 20px;
        }

        h3, h5 {
            color: #1A3D63;
            font-weight: 700;
        }

        #calendar {
            width: 100%;
            min-height: 520px;
        }

        @media (max-width: 992px) {
            #calendar {
                min-height: 450px;
            }
        }

        .btn-blue {
            background: linear-gradient(135deg, #4A7FA7, #1A3D63);
            color: white;
            border-radius: 12px;
            border: none;
        }

        .btn-blue:hover {
            opacity: 0.9;
        }
    </style>
</head>

<body>

<a href="/dashboard" class="btn btn-outline-dark mb-3">‚¨Ö Back</a>

<div class="container-fluid">
    <div class="row g-4">

        <!-- LEFT COLUMN : CALENDAR -->
        <div class="col-12 col-lg-8">
            <div class="card-box">
                <h3 class="text-center mb-3">üìÖ Calendar</h3>
                <div id="calendar"></div>
            </div>
        </div>

        <!-- RIGHT COLUMN : EVENT MANAGER -->
        <div class="col-12 col-lg-4">

            <!-- ADD EVENT -->
            <div class="card-box mb-3">
                <h5>‚ûï Add Event</h5>
                <form method="POST" action="/calendar/add" class="row g-2">
                    <input name="title" class="form-control" placeholder="Event title" required>
                    <input type="date" name="date" class="form-control" required>
                    <input type="time" name="time" class="form-control">
                    <select name="category" class="form-select">
                        <option>Personal</option>
                        <option>Work</option>
                    </select>
                    <input name="notes" class="form-control" placeholder="Notes (optional)">
                    <label class="small">
                        <input type="checkbox" name="important"> Mark Important ‚≠ê
                    </label>
                    <input type="datetime-local" name="reminder_at" class="form-control">
                    <button class="btn-blue w-100 mt-2">Add Event</button>
                </form>
            </div>

            <!-- TODAY EVENTS -->
            <div class="card-box mb-3">
                <h5>üìå Today ({{ today }})</h5>
                {% if events_today %}
                    <ul class="list-group">
                        {% for ev in events_today %}
                        <li class="list-group-item">
                            <strong>{{ ev['time'] or '‚Äî' }}</strong> {{ ev['title'] }}
                        </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p class="text-muted">No events today.</p>
                {% endif %}
            </div>

            <!-- UPCOMING EVENTS -->
            <div class="card-box mb-3">
                <h5>üîî Upcoming</h5>
                {% if upcoming %}
                    <ul class="list-group">
                        {% for ev in upcoming %}
                        <li class="list-group-item">
                            {{ ev['date'] }} ‚Äî {{ ev['title'] }}
                        </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p class="text-muted">No upcoming events.</p>
                {% endif %}
            </div>

            <!-- ALL EVENTS -->
            <div class="card-box">
                <h5>üìò All Events</h5>
                {% if events_all %}
                    <ul class="list-group">
                        {% for ev in events_all %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span>{{ ev['title'] }}</span>
                            <span>
                                <a href="/calendar/edit/{{ ev['id'] }}" class="btn btn-sm btn-outline-primary">Edit</a>
                                <a href="/calendar/delete/{{ ev['id'] }}" class="btn btn-sm btn-outline-danger">Del</a>
                            </span>
                        </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p class="text-muted">No events added.</p>
                {% endif %}
            </div>

        </div>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const calendarEl = document.getElementById("calendar");

    const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: "dayGridMonth",
        height: "auto",
        expandRows: true,
        handleWindowResize: true,
        events: "/api/events",
        headerToolbar: {
            left: "prev,next today",
            center: "title",
            right: "dayGridMonth,timeGridWeek,timeGridDay"
        }
    });

    calendar.render();
});
</script>

</body>
</html>
